<div class="manage-advertisers-page">
    <!-- Header -->
    <div class="page-header">
        <div class="header-left">
            <h1 class="page-title">Manage Advertisers</h1>
            <span class="advertiser-count">{{totalItems}} Advertisers</span>
        </div>
        <div class="header-actions">
            <button class="btn btn-add" (click)="openAddModal()">
                <i class="fas fa-plus"></i> Add New
            </button>
            <div class="dropdown">
                <button class="btn btn-actions dropdown-toggle" data-bs-toggle="dropdown">
                    Actions <i class="fas fa-chevron-down"></i>
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item">Export</a></li>
                    <li><a class="dropdown-item">Bulk Update</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="content-wrapper" [class.filters-open]="showFilters">
        <!-- Table Section -->
        <div class="table-section">
            <div class="table-header">
                <div class="pagination-info">
                    <button class="btn-page" [disabled]="currentPage === 1" (click)="goToPage(1)">
                        <i class="fas fa-angle-double-left"></i>
                    </button>
                    <button class="btn-page" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
                        <i class="fas fa-angle-left"></i>
                    </button>
                    <span class="page-numbers">
                        <span *ngFor="let p of [1,2,3,4,5]" class="page-num" [class.active]="p === currentPage"
                            (click)="goToPage(p)">{{p}}</span>
                    </span>
                    <button class="btn-page" [disabled]="currentPage === totalPages"
                        (click)="goToPage(currentPage + 1)">
                        <i class="fas fa-angle-right"></i>
                    </button>
                    <button class="btn-page" [disabled]="currentPage === totalPages" (click)="goToPage(totalPages)">
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                    <select class="items-per-page" [(ngModel)]="itemsPerPage" (ngModelChange)="loadAdvertisers()">
                        <option [value]="10">10</option>
                        <option [value]="25">25</option>
                        <option [value]="50">50</option>
                        <option [value]="100">100</option>
                    </select>
                </div>
                <div class="table-actions">
                    <button class="btn-icon" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn-icon" (click)="toggleFilters()" [class.active]="showFilters" title="Filters">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>
            </div>

            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col">
                                <input type="checkbox">
                            </th>
                            <th *ngFor="let col of visibleColumns">{{col.label}}</th>
                            <th class="action-col">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loading State -->
                        <tr *ngIf="loading">
                            <td [attr.colspan]="visibleColumns.length + 2" class="text-center">
                                <div class="loading-spinner">
                                    <i class="fas fa-spinner fa-spin"></i> Loading advertisers...
                                </div>
                            </td>
                        </tr>

                        <!-- Error State -->
                        <tr *ngIf="error && !loading">
                            <td [attr.colspan]="visibleColumns.length + 2" class="text-center">
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i> {{error}}
                                </div>
                            </td>
                        </tr>

                        <!-- No Data State -->
                        <tr *ngIf="!loading && !error && paginatedAdvertisers.length === 0">
                            <td [attr.colspan]="visibleColumns.length + 2" class="text-center">
                                <div class="no-data">
                                    <i class="fas fa-inbox"></i> No advertisers found
                                </div>
                            </td>
                        </tr>


                        <!-- Data Rows -->
                        <ng-container *ngIf="!loading && !error">
                            <tr *ngFor="let adv of paginatedAdvertisers">
                                <td class="checkbox-col">
                                    <input type="checkbox">
                                </td>
                                <td *ngIf="columns[0].visible">{{adv.id}}</td>
                                <td *ngIf="columns[1].visible" class="name-cell">
                                    <div class="advertiser-info">
                                        <div class="avatar"
                                            [style.background-color]="'#' + (adv.id * 123456).toString(16).slice(0,6)">
                                            {{adv.name.charAt(0)}}
                                        </div>
                                        <div class="info">
                                            <a class="name-link" (click)="viewAdvertiser(adv.id)">{{adv.name}}</a>
                                            <span class="email">{{adv.email}}</span>
                                        </div>
                                    </div>
                                </td>
                                <td *ngIf="columns[2].visible">{{adv.company_name || '-'}}</td>
                                <td *ngIf="columns[3].visible">
                                    <span class="status-badge"
                                        [ngClass]="getStatusClass(adv.status)">{{adv.status}}</span>
                                </td>
                                <td *ngIf="columns[4].visible">{{adv.created_at | date:'MMM d, yyyy'}}</td>
                                <td *ngIf="columns[5].visible">{{adv.website || '-'}}</td>
                                <td *ngIf="columns[6].visible">{{adv.industry || '-'}}</td>
                                <td *ngIf="columns[7].visible">{{adv.email}}</td>
                                <td *ngIf="columns[8].visible">{{adv.country || '-'}}</td>
                                <td *ngIf="columns[9].visible">{{adv.currency || '-'}}</td>
                                <td class="action-col">
                                    <div class="action-dropdown">
                                        <button class="btn-action" data-bs-toggle="dropdown">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li><a class="dropdown-item" (click)="viewAdvertiser(adv.id)">
                                                    <i class="fas fa-eye"></i> View</a>
                                            </li>
                                            <li><a class="dropdown-item" (click)="editAdvertiser(adv.id)">
                                                    <i class="fas fa-edit"></i> Edit</a>
                                            </li>
                                            <li><a class="dropdown-item text-danger">
                                                    <i class="fas fa-ban"></i> Disable</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Filter Sidebar Overlay -->
        <div class="filter-sidebar-overlay" *ngIf="showFilters" (click)="closeFilterPanel()"></div>

        <!-- Filter Sidebar - Trackier Style with Collapsible Sections -->
        <div class="filter-sidebar" [class.open]="showFilters">
            <div class="filter-sidebar-header">
                <h5>Filters</h5>
                <button type="button" class="btn-close" (click)="closeFilterPanel()"></button>
            </div>

            <div class="filter-sidebar-body">
                <!-- Advertiser ID Section -->
                <div class="filter-card">
                    <div class="filter-card-header" (click)="toggleSection('advertiserId')">
                        <span>Advertiser ID</span>
                        <i class="fas"
                            [ngClass]="collapsedSections.advertiserId ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                    </div>
                    <div class="filter-card-body" *ngIf="!collapsedSections.advertiserId">
                        <input type="text" class="form-control form-control-sm" [(ngModel)]="filterAdvertiserId"
                            placeholder="Enter Advertiser id">
                    </div>
                </div>

                <!-- Contact/Company Name Section -->
                <div class="filter-card">
                    <div class="filter-card-header" (click)="toggleSection('contactName')">
                        <span>Contact/Company Name</span>
                        <i class="fas"
                            [ngClass]="collapsedSections.contactName ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                    </div>
                    <div class="filter-card-body" *ngIf="!collapsedSections.contactName">
                        <input type="text" class="form-control form-control-sm" [(ngModel)]="filterName"
                            placeholder="Enter Advertiser/company name">
                    </div>
                </div>

                <!-- Status Section -->
                <div class="filter-card">
                    <div class="filter-card-header" (click)="toggleSection('status')">
                        <span>Status</span>
                        <i class="fas" [ngClass]="collapsedSections.status ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                    </div>
                    <div class="filter-card-body" *ngIf="!collapsedSections.status">
                        <select class="form-select form-select-sm" [(ngModel)]="filterStatus">
                            <option value="">All Statuses</option>
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                </div>

                <!-- Email Section -->
                <div class="filter-card">
                    <div class="filter-card-header" (click)="toggleSection('email')">
                        <span>Email</span>
                        <i class="fas" [ngClass]="collapsedSections.email ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                    </div>
                    <div class="filter-card-body" *ngIf="!collapsedSections.email">
                        <input type="text" class="form-control form-control-sm" [(ngModel)]="filterEmail"
                            placeholder="Enter Advertiser Email">
                    </div>
                </div>

                <!-- Manager Section -->
                <div class="filter-card">
                    <div class="filter-card-header" (click)="toggleSection('manager')">
                        <span>Manager</span>
                        <i class="fas" [ngClass]="collapsedSections.manager ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                    </div>
                    <div class="filter-card-body" *ngIf="!collapsedSections.manager">
                        <select class="form-select form-select-sm" [(ngModel)]="filterManager">
                            <option value="">Enter Manager's Name</option>
                            <option *ngFor="let m of managers" [value]="m.name">{{m.name}}</option>
                        </select>
                    </div>
                </div>

                <!-- Columns Section -->
                <div class="filter-card columns-card">
                    <div class="filter-card-header" (click)="toggleSection('columns')">
                        <span>Columns</span>
                        <i class="fas" [ngClass]="collapsedSections.columns ? 'â€‹fa-chevron-down' : 'fa-chevron-up'"></i>
                    </div>
                    <div class="filter-card-body" *ngIf="!collapsedSections.columns">
                        <!-- Column Search and Actions -->
                        <div class="columns-header">
                            <input type="text" class="form-control form-control-sm" [(ngModel)]="columnSearchQuery"
                                placeholder="Search columns...">
                            <div class="columns-actions">
                                <button class="btn btn-sm btn-light border" (click)="resetColumnsToDefault()"
                                    title="Reset to Default">
                                    <i class="fas fa-undo"></i>
                                </button>
                                <button class="btn btn-sm btn-light border ms-1" (click)="selectAllColumns()"
                                    title="Select All">
                                    <i class="fas fa-check-double"></i>
                                </button>
                            </div>
                        </div>
                        <!-- Column Checkboxes -->
                        <div class="columns-list">
                            <div class="form-check" *ngFor="let col of filteredColumns">
                                <input class="form-check-input" type="checkbox" [checked]="col.visible"
                                    (change)="toggleColumn(col)" [id]="'col_' + col.key">
                                <label class="form-check-label" [for]="'col_' + col.key">{{col.label}}</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="filter-sidebar-footer">
                <button class="btn btn-primary btn-sm" (click)="applyFilters()">
                    <i class="fas fa-check me-1"></i> Apply
                </button>
                <button class="btn btn-outline-secondary btn-sm" (click)="closeFilterPanel()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Add Advertiser Right Panel -->
    <div class="add-advertiser-panel" *ngIf="showAddModal">
        <div class="panel-overlay" (click)="closeAddModal()"></div>
        <div class="panel-content">
            <div class="panel-header">
                <div class="header-content">
                    <h5 class="panel-title">Add an Advertiser</h5>
                    <p class="help-link">To know more, <a href="#" target="_blank">click here.</a></p>
                </div>
                <button class="btn-close-panel" (click)="closeAddModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="panel-body">
                <h6 class="section-title">Details</h6>

                <!-- Error Message -->
                <div class="alert alert-danger" *ngIf="saveError">
                    <i class="fas fa-exclamation-circle"></i> {{saveError}}
                </div>

                <form>
                    <!-- Full Name -->
                    <div class="form-group">
                        <label class="form-label">Full Name <span class="required">*</span></label>
                        <input type="text" class="form-control" [(ngModel)]="newAdvertiser.name" name="name"
                            placeholder="The name of your advertiser/website/resource" required minlength="3">
                        <small class="form-help-text">Minimum 3 characters</small>
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label class="form-label">Email <span class="required">*</span></label>
                        <input type="email" class="form-control" [(ngModel)]="newAdvertiser.email" name="email"
                            placeholder="Enter Unique email of your advertiser" required>
                    </div>

                    <!-- Account Status -->
                    <div class="form-group">
                        <label class="form-label">Account Status <span class="required">*</span></label>
                        <select class="form-control" [(ngModel)]="newAdvertiser.status" name="status" required>
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="disabled">Disabled</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>

                    <!-- Company (Optional) -->
                    <div class="form-group">
                        <label class="form-label">Company (Optional)</label>
                        <input type="text" class="form-control" [(ngModel)]="newAdvertiser.company" name="company"
                            placeholder="Company/Organization name">
                    </div>

                    <!-- Reference ID -->
                    <div class="form-group">
                        <label class="form-label">Reference ID</label>
                        <input type="text" class="form-control" [(ngModel)]="newAdvertiser.reference_id"
                            name="reference_id" placeholder="Reference ID">
                    </div>

                    <!-- Password (Optional) -->
                    <div class="form-group">
                        <label class="form-label">Password (Optional)</label>
                        <input type="password" class="form-control" [(ngModel)]="newAdvertiser.password" name="password"
                            placeholder="8 characters minimum or leave empty to autogenerate" minlength="8">
                        <small class="form-help-text">Minimum 8 characters</small>
                    </div>

                    <!-- Account Manager (Optional) -->
                    <div class="form-group">
                        <label class="form-label">Account Manager (Optional)</label>
                        <select class="form-control" [(ngModel)]="newAdvertiser.manager" name="manager">
                            <option value="">Select Manager</option>
                            <option *ngFor="let m of managers" [value]="m.name">{{m.name}} - ({{m.role}})</option>
                        </select>
                    </div>

                    <!-- Notes (Optional) -->
                    <div class="form-group">
                        <label class="form-label">Notes (Optional)</label>
                        <textarea class="form-control" [(ngModel)]="newAdvertiser.notes" name="notes" rows="3"
                            placeholder="Enter notes"></textarea>
                        <small class="form-help-text">The content will not be displayed to advertiser or
                            publisher</small>
                    </div>

                    <!-- Notify by Email -->
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" [(ngModel)]="newAdvertiser.notify_email"
                                name="notify_email" id="notifyEmail">
                            <label class="form-check-label" for="notifyEmail">
                                Notify this user by email
                            </label>
                        </div>
                        <small class="form-help-text">Setup SMTP first by <a href="#" target="_blank">Clicking Here</a>
                            to send email to the advertiser</small>
                    </div>
                </form>
            </div>

            <div class="panel-footer">
                <button class="btn btn-save" (click)="saveAdvertiser()" [disabled]="saving">
                    <i class="fas" [ngClass]="saving ? 'fa-spinner fa-spin' : 'fa-check'"></i>
                    {{saving ? 'Saving...' : 'Save'}}
                </button>
                <button class="btn btn-cancel" (click)="closeAddModal()" [disabled]="saving">Cancel</button>
            </div>
        </div>
    </div>
</div>